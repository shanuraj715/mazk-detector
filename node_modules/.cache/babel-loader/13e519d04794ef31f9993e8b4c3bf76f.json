{"ast":null,"code":"/**\n    * @license\n    * Copyright 2019 Google LLC. All Rights Reserved.\n    * Licensed under the Apache License, Version 2.0 (the \"License\");\n    * you may not use this file except in compliance with the License.\n    * You may obtain a copy of the License at\n    *\n    * http://www.apache.org/licenses/LICENSE-2.0\n    *\n    * Unless required by applicable law or agreed to in writing, software\n    * distributed under the License is distributed on an \"AS IS\" BASIS,\n    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    * See the License for the specific language governing permissions and\n    * limitations under the License.\n    * =============================================================================\n    */\nimport { util, tidy, keep, div } from \"@tensorflow/tfjs-core\";\n\nfunction __awaiter(t, a, e, s) {\n  return new (e || (e = Promise))(function (r, i) {\n    function n(t) {\n      try {\n        o(s.next(t));\n      } catch (t) {\n        i(t);\n      }\n    }\n\n    function l(t) {\n      try {\n        o(s.throw(t));\n      } catch (t) {\n        i(t);\n      }\n    }\n\n    function o(t) {\n      t.done ? r(t.value) : new e(function (a) {\n        a(t.value);\n      }).then(n, l);\n    }\n\n    o((s = s.apply(t, a || [])).next());\n  });\n}\n\nfunction __generator(t, a) {\n  var e,\n      s,\n      r,\n      i,\n      n = {\n    label: 0,\n    sent: function () {\n      if (1 & r[0]) throw r[1];\n      return r[1];\n    },\n    trys: [],\n    ops: []\n  };\n  return i = {\n    next: l(0),\n    throw: l(1),\n    return: l(2)\n  }, \"function\" == typeof Symbol && (i[Symbol.iterator] = function () {\n    return this;\n  }), i;\n\n  function l(i) {\n    return function (l) {\n      return function (i) {\n        if (e) throw new TypeError(\"Generator is already executing.\");\n\n        for (; n;) try {\n          if (e = 1, s && (r = 2 & i[0] ? s.return : i[0] ? s.throw || ((r = s.return) && r.call(s), 0) : s.next) && !(r = r.call(s, i[1])).done) return r;\n\n          switch (s = 0, r && (i = [2 & i[0], r.value]), i[0]) {\n            case 0:\n            case 1:\n              r = i;\n              break;\n\n            case 4:\n              return n.label++, {\n                value: i[1],\n                done: !1\n              };\n\n            case 5:\n              n.label++, s = i[1], i = [0];\n              continue;\n\n            case 7:\n              i = n.ops.pop(), n.trys.pop();\n              continue;\n\n            default:\n              if (!(r = (r = n.trys).length > 0 && r[r.length - 1]) && (6 === i[0] || 2 === i[0])) {\n                n = 0;\n                continue;\n              }\n\n              if (3 === i[0] && (!r || i[1] > r[0] && i[1] < r[3])) {\n                n.label = i[1];\n                break;\n              }\n\n              if (6 === i[0] && n.label < r[1]) {\n                n.label = r[1], r = i;\n                break;\n              }\n\n              if (r && n.label < r[2]) {\n                n.label = r[2], n.ops.push(i);\n                break;\n              }\n\n              r[2] && n.ops.pop(), n.trys.pop();\n              continue;\n          }\n\n          i = a.call(t, n);\n        } catch (t) {\n          i = [6, t], s = 0;\n        } finally {\n          e = r = 0;\n        }\n\n        if (5 & i[0]) throw i[1];\n        return {\n          value: i[0] ? i[1] : void 0,\n          done: !0\n        };\n      }([i, l]);\n    };\n  }\n}\n\nfunction concatWithNulls(t, a) {\n  return null == t && null == a ? null : null == t ? a.clone() : null === a ? t.clone() : t.concat(a, 0);\n}\n\nfunction topK(t, a) {\n  for (var e = [], s = 0; s < t.length; s++) e.push({\n    value: t[s],\n    index: s\n  });\n\n  e.sort(function (t, a) {\n    return a.value - t.value;\n  });\n  var r = new Float32Array(a),\n      i = new Int32Array(a);\n\n  for (s = 0; s < a; s++) r[s] = e[s].value, i[s] = e[s].index;\n\n  return {\n    values: r,\n    indices: i\n  };\n}\n\nvar version = \"1.2.2\",\n    KNNClassifier = function () {\n  function t() {\n    this.classDatasetMatrices = {}, this.classExampleCount = {}, this.labelToClassId = {}, this.nextClassId = 0;\n  }\n\n  return t.prototype.addExample = function (t, a) {\n    var e = this;\n    if (null == this.exampleShape && (this.exampleShape = t.shape), !util.arraysEqual(this.exampleShape, t.shape)) throw new Error(\"Example shape provided, \" + t.shape + \" does not match previously provided example shapes \" + this.exampleShape + \".\");\n    this.clearTrainDatasetMatrix(), a in this.labelToClassId || (this.labelToClassId[a] = this.nextClassId++), tidy(function () {\n      var s = e.normalizeVectorToUnitLength(t.flatten()),\n          r = s.shape[0];\n      if (null == e.classDatasetMatrices[a]) e.classDatasetMatrices[a] = s.as2D(1, r);else {\n        var i = e.classDatasetMatrices[a].as2D(e.classExampleCount[a], r).concat(s.as2D(1, r), 0);\n        e.classDatasetMatrices[a].dispose(), e.classDatasetMatrices[a] = i;\n      }\n      keep(e.classDatasetMatrices[a]), null == e.classExampleCount[a] && (e.classExampleCount[a] = 0), e.classExampleCount[a]++;\n    });\n  }, t.prototype.similarities = function (t) {\n    var a = this;\n    return tidy(function () {\n      var e = a.normalizeVectorToUnitLength(t.flatten()),\n          s = e.shape[0];\n\n      if (null == a.trainDatasetMatrix) {\n        var r = null;\n\n        for (var i in a.classDatasetMatrices) r = concatWithNulls(r, a.classDatasetMatrices[i]);\n\n        a.trainDatasetMatrix = r;\n      }\n\n      if (null == a.trainDatasetMatrix) return console.warn(\"Cannot predict without providing training examples.\"), null;\n      keep(a.trainDatasetMatrix);\n      var n = a.getNumExamples();\n      return a.trainDatasetMatrix.as2D(n, s).matMul(e.as2D(s, 1)).as1D();\n    });\n  }, t.prototype.predictClass = function (t, a) {\n    return void 0 === a && (a = 3), __awaiter(this, void 0, void 0, function () {\n      var e,\n          s,\n          r,\n          i,\n          n = this;\n      return __generator(this, function (l) {\n        switch (l.label) {\n          case 0:\n            if (a < 1) throw new Error(\"Please provide a positive integer k value to predictClass.\");\n            if (0 === this.getNumExamples()) throw new Error(\"You have not added any examples to the KNN classifier. Please add examples before calling predictClass.\");\n            return e = tidy(function () {\n              return n.similarities(t).asType(\"float32\");\n            }), s = Math.min(a, this.getNumExamples()), i = topK, [4, e.data()];\n\n          case 1:\n            return r = i.apply(void 0, [l.sent(), s]).indices, e.dispose(), [2, this.calculateTopClass(r, s)];\n        }\n      });\n    });\n  }, t.prototype.clearClass = function (t) {\n    if (null == this.classDatasetMatrices[t]) throw new Error(\"Cannot clear invalid class \" + t);\n    this.classDatasetMatrices[t].dispose(), delete this.classDatasetMatrices[t], delete this.classExampleCount[t], this.clearTrainDatasetMatrix();\n  }, t.prototype.clearAllClasses = function () {\n    for (var t in this.classDatasetMatrices) this.clearClass(t);\n  }, t.prototype.getClassExampleCount = function () {\n    return this.classExampleCount;\n  }, t.prototype.getClassifierDataset = function () {\n    return this.classDatasetMatrices;\n  }, t.prototype.getNumClasses = function () {\n    return Object.keys(this.classExampleCount).length;\n  }, t.prototype.setClassifierDataset = function (t) {\n    for (var a in this.clearTrainDatasetMatrix(), this.classDatasetMatrices = t, t) this.classExampleCount[a] = t[a].shape[0];\n  }, t.prototype.calculateTopClass = function (t, a) {\n    var e,\n        s = {};\n    if (null == t) return {\n      classIndex: this.labelToClassId[e],\n      label: e,\n      confidences: s\n    };\n    var r = {},\n        i = 0;\n\n    for (var n in this.classDatasetMatrices) i += this.classExampleCount[n], r[n] = i;\n\n    var l = {};\n\n    for (var n in this.classDatasetMatrices) l[n] = 0;\n\n    for (var o = 0; o < t.length; o++) {\n      var c = t[o];\n\n      for (var n in this.classDatasetMatrices) if (c < r[n]) {\n        l[n]++;\n        break;\n      }\n    }\n\n    var u = 0;\n\n    for (var n in this.classDatasetMatrices) {\n      var p = l[n] / a;\n      p > u && (u = p, e = n), s[n] = p;\n    }\n\n    return {\n      classIndex: this.labelToClassId[e],\n      label: e,\n      confidences: s\n    };\n  }, t.prototype.clearTrainDatasetMatrix = function () {\n    null != this.trainDatasetMatrix && (this.trainDatasetMatrix.dispose(), this.trainDatasetMatrix = null);\n  }, t.prototype.normalizeVectorToUnitLength = function (t) {\n    return tidy(function () {\n      var a = t.norm();\n      return div(t, a);\n    });\n  }, t.prototype.getNumExamples = function () {\n    var t = 0;\n\n    for (var a in this.classDatasetMatrices) t += this.classExampleCount[a];\n\n    return t;\n  }, t.prototype.dispose = function () {\n    for (var t in this.clearTrainDatasetMatrix(), this.classDatasetMatrices) this.classDatasetMatrices[t].dispose();\n  }, t;\n}();\n\nfunction create() {\n  return new KNNClassifier();\n}\n\nexport { KNNClassifier, create, version };","map":{"version":3,"sources":["D:/Projects/maskdetector/node_modules/@tensorflow-models/knn-classifier/dist/knn-classifier.esm.js"],"names":["util","tidy","keep","div","__awaiter","t","a","e","s","Promise","r","i","n","o","next","l","throw","done","value","then","apply","__generator","label","sent","trys","ops","return","Symbol","iterator","TypeError","call","pop","length","push","concatWithNulls","clone","concat","topK","index","sort","Float32Array","Int32Array","values","indices","version","KNNClassifier","classDatasetMatrices","classExampleCount","labelToClassId","nextClassId","prototype","addExample","exampleShape","shape","arraysEqual","Error","clearTrainDatasetMatrix","normalizeVectorToUnitLength","flatten","as2D","dispose","similarities","trainDatasetMatrix","console","warn","getNumExamples","matMul","as1D","predictClass","asType","Math","min","data","calculateTopClass","clearClass","clearAllClasses","getClassExampleCount","getClassifierDataset","getNumClasses","Object","keys","setClassifierDataset","classIndex","confidences","c","u","p","norm","create"],"mappings":"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","sourcesContent":["/**\n    * @license\n    * Copyright 2019 Google LLC. All Rights Reserved.\n    * Licensed under the Apache License, Version 2.0 (the \"License\");\n    * you may not use this file except in compliance with the License.\n    * You may obtain a copy of the License at\n    *\n    * http://www.apache.org/licenses/LICENSE-2.0\n    *\n    * Unless required by applicable law or agreed to in writing, software\n    * distributed under the License is distributed on an \"AS IS\" BASIS,\n    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    * See the License for the specific language governing permissions and\n    * limitations under the License.\n    * =============================================================================\n    */\nimport{util,tidy,keep,div}from\"@tensorflow/tfjs-core\";function __awaiter(t,a,e,s){return new(e||(e=Promise))(function(r,i){function n(t){try{o(s.next(t))}catch(t){i(t)}}function l(t){try{o(s.throw(t))}catch(t){i(t)}}function o(t){t.done?r(t.value):new e(function(a){a(t.value)}).then(n,l)}o((s=s.apply(t,a||[])).next())})}function __generator(t,a){var e,s,r,i,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(e)throw new TypeError(\"Generator is already executing.\");for(;n;)try{if(e=1,s&&(r=2&i[0]?s.return:i[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,i[1])).done)return r;switch(s=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,s=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!(r=(r=n.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){n=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){n.label=i[1];break}if(6===i[0]&&n.label<r[1]){n.label=r[1],r=i;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(i);break}r[2]&&n.ops.pop(),n.trys.pop();continue}i=a.call(t,n)}catch(t){i=[6,t],s=0}finally{e=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}function concatWithNulls(t,a){return null==t&&null==a?null:null==t?a.clone():null===a?t.clone():t.concat(a,0)}function topK(t,a){for(var e=[],s=0;s<t.length;s++)e.push({value:t[s],index:s});e.sort(function(t,a){return a.value-t.value});var r=new Float32Array(a),i=new Int32Array(a);for(s=0;s<a;s++)r[s]=e[s].value,i[s]=e[s].index;return{values:r,indices:i}}var version=\"1.2.2\",KNNClassifier=function(){function t(){this.classDatasetMatrices={},this.classExampleCount={},this.labelToClassId={},this.nextClassId=0}return t.prototype.addExample=function(t,a){var e=this;if(null==this.exampleShape&&(this.exampleShape=t.shape),!util.arraysEqual(this.exampleShape,t.shape))throw new Error(\"Example shape provided, \"+t.shape+\" does not match previously provided example shapes \"+this.exampleShape+\".\");this.clearTrainDatasetMatrix(),a in this.labelToClassId||(this.labelToClassId[a]=this.nextClassId++),tidy(function(){var s=e.normalizeVectorToUnitLength(t.flatten()),r=s.shape[0];if(null==e.classDatasetMatrices[a])e.classDatasetMatrices[a]=s.as2D(1,r);else{var i=e.classDatasetMatrices[a].as2D(e.classExampleCount[a],r).concat(s.as2D(1,r),0);e.classDatasetMatrices[a].dispose(),e.classDatasetMatrices[a]=i}keep(e.classDatasetMatrices[a]),null==e.classExampleCount[a]&&(e.classExampleCount[a]=0),e.classExampleCount[a]++})},t.prototype.similarities=function(t){var a=this;return tidy(function(){var e=a.normalizeVectorToUnitLength(t.flatten()),s=e.shape[0];if(null==a.trainDatasetMatrix){var r=null;for(var i in a.classDatasetMatrices)r=concatWithNulls(r,a.classDatasetMatrices[i]);a.trainDatasetMatrix=r}if(null==a.trainDatasetMatrix)return console.warn(\"Cannot predict without providing training examples.\"),null;keep(a.trainDatasetMatrix);var n=a.getNumExamples();return a.trainDatasetMatrix.as2D(n,s).matMul(e.as2D(s,1)).as1D()})},t.prototype.predictClass=function(t,a){return void 0===a&&(a=3),__awaiter(this,void 0,void 0,function(){var e,s,r,i,n=this;return __generator(this,function(l){switch(l.label){case 0:if(a<1)throw new Error(\"Please provide a positive integer k value to predictClass.\");if(0===this.getNumExamples())throw new Error(\"You have not added any examples to the KNN classifier. Please add examples before calling predictClass.\");return e=tidy(function(){return n.similarities(t).asType(\"float32\")}),s=Math.min(a,this.getNumExamples()),i=topK,[4,e.data()];case 1:return r=i.apply(void 0,[l.sent(),s]).indices,e.dispose(),[2,this.calculateTopClass(r,s)]}})})},t.prototype.clearClass=function(t){if(null==this.classDatasetMatrices[t])throw new Error(\"Cannot clear invalid class \"+t);this.classDatasetMatrices[t].dispose(),delete this.classDatasetMatrices[t],delete this.classExampleCount[t],this.clearTrainDatasetMatrix()},t.prototype.clearAllClasses=function(){for(var t in this.classDatasetMatrices)this.clearClass(t)},t.prototype.getClassExampleCount=function(){return this.classExampleCount},t.prototype.getClassifierDataset=function(){return this.classDatasetMatrices},t.prototype.getNumClasses=function(){return Object.keys(this.classExampleCount).length},t.prototype.setClassifierDataset=function(t){for(var a in this.clearTrainDatasetMatrix(),this.classDatasetMatrices=t,t)this.classExampleCount[a]=t[a].shape[0]},t.prototype.calculateTopClass=function(t,a){var e,s={};if(null==t)return{classIndex:this.labelToClassId[e],label:e,confidences:s};var r={},i=0;for(var n in this.classDatasetMatrices)i+=this.classExampleCount[n],r[n]=i;var l={};for(var n in this.classDatasetMatrices)l[n]=0;for(var o=0;o<t.length;o++){var c=t[o];for(var n in this.classDatasetMatrices)if(c<r[n]){l[n]++;break}}var u=0;for(var n in this.classDatasetMatrices){var p=l[n]/a;p>u&&(u=p,e=n),s[n]=p}return{classIndex:this.labelToClassId[e],label:e,confidences:s}},t.prototype.clearTrainDatasetMatrix=function(){null!=this.trainDatasetMatrix&&(this.trainDatasetMatrix.dispose(),this.trainDatasetMatrix=null)},t.prototype.normalizeVectorToUnitLength=function(t){return tidy(function(){var a=t.norm();return div(t,a)})},t.prototype.getNumExamples=function(){var t=0;for(var a in this.classDatasetMatrices)t+=this.classExampleCount[a];return t},t.prototype.dispose=function(){for(var t in this.clearTrainDatasetMatrix(),this.classDatasetMatrices)this.classDatasetMatrices[t].dispose()},t}();function create(){return new KNNClassifier}export{KNNClassifier,create,version};\n"]},"metadata":{},"sourceType":"module"}